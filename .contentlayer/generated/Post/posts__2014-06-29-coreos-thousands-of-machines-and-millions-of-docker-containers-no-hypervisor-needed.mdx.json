{
  "title": "CoreOS: thousands of machines and millions of Docker containers... no hypervisor needed.",
  "excerpt": "I have been playing around with CoreOS to get a sense of how everything works. The vision of this project is incredible. CoreOS describes itself as \"a new Linux distribution that has been re-architected to provide features needed to run modern infrastructure stacks. The strategies and architectures that influence CoreOS allow companies like Google, Facebook and Twitter to run their services at scale with high resilience.\"",
  "coverImage": "/assets/blog/img/coreos_2.png",
  "date": "2014-06-29T00:00:00.000Z",
  "published": true,
  "author": {
    "name": "Dan Stroot",
    "picture": "/assets/blog/authors/dan.jpeg",
    "type": "Author",
    "_raw": {}
  },
  "ogImage": {
    "url": "/assets/blog/img/coreos_2.png",
    "type": "OGImage",
    "_raw": {}
  },
  "seoURL": "https://danstroot.com/2014/06/28/coreos-thousands-of-machines-and-millions-of-docker-containers-no-hypervisor-needed/",
  "body": {
    "raw": "\nI have been playing around with CoreOS to get a sense of how everything works. The vision of this project is incredible.\n\nCoreOS describes itself as _\"a new Linux distribution that has been re-architected to provide features needed to run modern infrastructure stacks. The strategies and architectures that influence CoreOS allow companies like Google, Facebook and Twitter to run their services at scale with high resilience.\"_\n\nCoreOS displaces hypervisors and machine virtualization in favor of Docker and Linux containers. CoreOS uses Linux containers to manage your services at a high level of abstraction. A single service's code and all dependencies are packaged within a container that can be run on one or many CoreOS machines.\n\nClustering works across platforms, meaning there is no cloud vendor lock-in. For example, CoreOS runs on Amazon EC2, Rackspace, QEMU/KVM, VMware and OpenStack and your own hardware. Running a single CoreOS cluster on multiple different clouds or cloud + bare metal is supported and encouraged. This lack of lock-in is the reason why I have supported OpenStack and CoreOS takes this even further.\n\n#### We begin with concept of a large fleet of machines that start (and remain) exactly consistent at the OS level\n\n- First, think of CoreOS somewhat like you might think of a hypervisor today. It is the first layer you put down on bare metal, or as a virtual machine in a cloud. It is a \"bare minimum\" Linux-based OS that supports Linux LXC containers.\n- It is designed to run as a large fleet (hive?) of machines. It includes built-in primitives such as distributed locking and master election, plus key services necessary to manage the fleet of machines. (more on this later).\n- It is meant to always be consistent across machines.\n  - CoreOS utilizes an active/passive dual-partition scheme to update the OS as a _single unit_ instead of _package by package_.\n  - CoreOS also has the tenant of **automatically** updating itself. This avoids the issue of inconsistent state from machine to machine within a large cluster. Conceptually this is roughly like a self-updating hypervisor.\n  - Each machine has to acquire and hold a reboot lock before it is allowed to reboot. The reboot lock is held until the machine releases it after a successful update. The number of machines allowed to reboot simultaneously is configurable. The main goal to allow for an update to be applied to a fleet quickly, without impacting capacity for the services running on the cluster.\n\n#### Next, we have the concept that the fleet of machines is simply a single pool of compute resources\n\n- You treat your CoreOS cluster as if it has a single, shared init system - one giant systemd if you will.\n- Instead of running a service on a specific machine, services are submitted to the cluster via the cluster manager, fleetctl, which decides where they should run.\n- Your services/applications are in containers that act as small, ephemeral units that can easily migrate around a cluster of self-updating CoreOS machines.\n- It is smart enough to distribute services across a cluster using machine-level affinity or anti-affinity.\n- If your application consists of 5 containers fleet will guarantee that they stay running somewhere on the cluster. If a machine fails or needs to be updated, containers running on that machine will be moved to other qualified machines in the cluster.\n\n#### ... with a single, shared brain\n\n- CoreOS provides a distributed key value store called \"etcd\".\n- The etcd client runs on each machine in a cluster. etcd gracefully handles master election during network partitions and the loss of the current master.\n- Docker containers can read, write and listen to etcd over the docker0 network interface. With these three actions you construct extremely sophisticated orchestration to happen whenever etcd values change. An example of this would be listening for changes and then to reconfigure an upstream proxy when a new container of an application is started.\n- Since etcd is replicated, all changes are reflected across the entire cluster. Your application can always reach the local etcd instance at 127.0.0.1:4001.\n- Your applications can read and write data into etcd. Common examples are storing database connection details, cache settings, feature flags, and more. Let's say we're running a simple web app like Wordpress. Instead of hardcoding our database address with in the config file, we'll fetch it from etcd instead. It's as simple as curl-ing [http://127.0.0.1:4001/v1/keys/database](http://127.0.0.1:4001/v1/keys/database) and using the response within your DB connection code.\n\n### Summary\n\nSo now we have a hive of self-updating Linux hosts with a single, distributed init system (systemd and fleet) and a single shared brain (etcd). It looks something like this:\n\n![CoreOS in Action](https://danstroot.imgix.net/assets/blog/img/coreos-action.png)\n\nThis depicts eight containers (two load balancers and six api servers) being managed by \"fleet\" to run in various CoreOS hosts in the cluster, with shared access to etcd.\n\nMomentum is shifting this way rapidly. Earlier this month Rackspace announced [OnMetal](https://www.rackspace.com/blog/onmetal-the-right-way-to-scale/). Rackspace's OnMetal Cloud Service is the first of its kind. Using OnMetal you create machine instances using OpenStack APIs but, instead of being provisioned a virtual machine, you are provisioned **on physical hardware**. OnMetal servers are single-tenant, bare-metal servers provisioned via the OpenStack API and can be spun up as quickly as VMs.\n\nOnce OnMetal is live, you'll be able to provision CoreOS instances on Rackspace's OnMetalcloud. This combination gives you the ease of spinning up machines with the click of a mouse, the security of running CoreOS with automatic updates, and the raw horsepower of running on bare metal. Pretty impressive!\n",
    "code": "var Component=(()=>{var cn=Object.create;var D=Object.defineProperty;var un=Object.getOwnPropertyDescriptor;var dn=Object.getOwnPropertyNames;var fn=Object.getPrototypeOf,mn=Object.prototype.hasOwnProperty;var z=(u,r)=>()=>(r||u((r={exports:{}}).exports,r),r.exports),bn=(u,r)=>{for(var p in r)D(u,p,{get:r[p],enumerable:!0})},xe=(u,r,p,y)=>{if(r&&typeof r==\"object\"||typeof r==\"function\")for(let v of dn(r))!mn.call(u,v)&&v!==p&&D(u,v,{get:()=>r[v],enumerable:!(y=un(r,v))||y.enumerable});return u};var hn=(u,r,p)=>(p=u!=null?cn(fn(u)):{},xe(r||!u||!u.__esModule?D(p,\"default\",{value:u,enumerable:!0}):p,u)),pn=u=>xe(D({},\"__esModule\",{value:!0}),u);var Ce=z((Nn,Ne)=>{Ne.exports=React});var Te=z(G=>{\"use strict\";(function(){\"use strict\";var u=Ce(),r=Symbol.for(\"react.element\"),p=Symbol.for(\"react.portal\"),y=Symbol.for(\"react.fragment\"),v=Symbol.for(\"react.strict_mode\"),X=Symbol.for(\"react.profiler\"),K=Symbol.for(\"react.provider\"),H=Symbol.for(\"react.context\"),O=Symbol.for(\"react.forward_ref\"),I=Symbol.for(\"react.suspense\"),F=Symbol.for(\"react.suspense_list\"),R=Symbol.for(\"react.memo\"),A=Symbol.for(\"react.lazy\"),Re=Symbol.for(\"react.offscreen\"),J=Symbol.iterator,Se=\"@@iterator\";function ke(e){if(e===null||typeof e!=\"object\")return null;var n=J&&e[J]||e[Se];return typeof n==\"function\"?n:null}var N=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function m(e){{for(var n=arguments.length,t=new Array(n>1?n-1:0),i=1;i<n;i++)t[i-1]=arguments[i];Ve(\"error\",e,t)}}function Ve(e,n,t){{var i=N.ReactDebugCurrentFrame,l=i.getStackAddendum();l!==\"\"&&(n+=\"%s\",t=t.concat([l]));var c=t.map(function(s){return String(s)});c.unshift(\"Warning: \"+n),Function.prototype.apply.call(console[e],console,c)}}var Pe=!1,je=!1,De=!1,Ie=!1,Fe=!1,Q;Q=Symbol.for(\"react.module.reference\");function Ae(e){return!!(typeof e==\"string\"||typeof e==\"function\"||e===y||e===X||Fe||e===v||e===I||e===F||Ie||e===Re||Pe||je||De||typeof e==\"object\"&&e!==null&&(e.$$typeof===A||e.$$typeof===R||e.$$typeof===K||e.$$typeof===H||e.$$typeof===O||e.$$typeof===Q||e.getModuleId!==void 0))}function Me(e,n,t){var i=e.displayName;if(i)return i;var l=n.displayName||n.name||\"\";return l!==\"\"?t+\"(\"+l+\")\":t}function Z(e){return e.displayName||\"Context\"}function g(e){if(e==null)return null;if(typeof e.tag==\"number\"&&m(\"Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue.\"),typeof e==\"function\")return e.displayName||e.name||null;if(typeof e==\"string\")return e;switch(e){case y:return\"Fragment\";case p:return\"Portal\";case X:return\"Profiler\";case v:return\"StrictMode\";case I:return\"Suspense\";case F:return\"SuspenseList\"}if(typeof e==\"object\")switch(e.$$typeof){case H:var n=e;return Z(n)+\".Consumer\";case K:var t=e;return Z(t._context)+\".Provider\";case O:return Me(e,e.render,\"ForwardRef\");case R:var i=e.displayName||null;return i!==null?i:g(e.type)||\"Memo\";case A:{var l=e,c=l._payload,s=l._init;try{return g(s(c))}catch{return null}}}return null}var x=Object.assign,w=0,ee,ne,te,re,ae,ie,oe;function se(){}se.__reactDisabledLog=!0;function Le(){{if(w===0){ee=console.log,ne=console.info,te=console.warn,re=console.error,ae=console.group,ie=console.groupCollapsed,oe=console.groupEnd;var e={configurable:!0,enumerable:!0,value:se,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}w++}}function Ye(){{if(w--,w===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:x({},e,{value:ee}),info:x({},e,{value:ne}),warn:x({},e,{value:te}),error:x({},e,{value:re}),group:x({},e,{value:ae}),groupCollapsed:x({},e,{value:ie}),groupEnd:x({},e,{value:oe})})}w<0&&m(\"disabledDepth fell below zero. This is a bug in React. Please file an issue.\")}}var M=N.ReactCurrentDispatcher,L;function S(e,n,t){{if(L===void 0)try{throw Error()}catch(l){var i=l.stack.trim().match(/\\n( *(at )?)/);L=i&&i[1]||\"\"}return`\n`+L+e}}var Y=!1,k;{var We=typeof WeakMap==\"function\"?WeakMap:Map;k=new We}function le(e,n){if(!e||Y)return\"\";{var t=k.get(e);if(t!==void 0)return t}var i;Y=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var c;c=M.current,M.current=null,Le();try{if(n){var s=function(){throw Error()};if(Object.defineProperty(s.prototype,\"props\",{set:function(){throw Error()}}),typeof Reflect==\"object\"&&Reflect.construct){try{Reflect.construct(s,[])}catch(_){i=_}Reflect.construct(e,[],s)}else{try{s.call()}catch(_){i=_}e.call(s.prototype)}}else{try{throw Error()}catch(_){i=_}e()}}catch(_){if(_&&i&&typeof _.stack==\"string\"){for(var o=_.stack.split(`\n`),b=i.stack.split(`\n`),d=o.length-1,f=b.length-1;d>=1&&f>=0&&o[d]!==b[f];)f--;for(;d>=1&&f>=0;d--,f--)if(o[d]!==b[f]){if(d!==1||f!==1)do if(d--,f--,f<0||o[d]!==b[f]){var h=`\n`+o[d].replace(\" at new \",\" at \");return e.displayName&&h.includes(\"<anonymous>\")&&(h=h.replace(\"<anonymous>\",e.displayName)),typeof e==\"function\"&&k.set(e,h),h}while(d>=1&&f>=0);break}}}finally{Y=!1,M.current=c,Ye(),Error.prepareStackTrace=l}var T=e?e.displayName||e.name:\"\",ye=T?S(T):\"\";return typeof e==\"function\"&&k.set(e,ye),ye}function $e(e,n,t){return le(e,!1)}function Ue(e){var n=e.prototype;return!!(n&&n.isReactComponent)}function V(e,n,t){if(e==null)return\"\";if(typeof e==\"function\")return le(e,Ue(e));if(typeof e==\"string\")return S(e);switch(e){case I:return S(\"Suspense\");case F:return S(\"SuspenseList\")}if(typeof e==\"object\")switch(e.$$typeof){case O:return $e(e.render);case R:return V(e.type,n,t);case A:{var i=e,l=i._payload,c=i._init;try{return V(c(l),n,t)}catch{}}}return\"\"}var P=Object.prototype.hasOwnProperty,ce={},ue=N.ReactDebugCurrentFrame;function j(e){if(e){var n=e._owner,t=V(e.type,e._source,n?n.type:null);ue.setExtraStackFrame(t)}else ue.setExtraStackFrame(null)}function qe(e,n,t,i,l){{var c=Function.call.bind(P);for(var s in e)if(c(e,s)){var o=void 0;try{if(typeof e[s]!=\"function\"){var b=Error((i||\"React class\")+\": \"+t+\" type `\"+s+\"` is invalid; it must be a function, usually from the `prop-types` package, but received `\"+typeof e[s]+\"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.\");throw b.name=\"Invariant Violation\",b}o=e[s](n,s,i,t,null,\"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED\")}catch(d){o=d}o&&!(o instanceof Error)&&(j(l),m(\"%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).\",i||\"React class\",t,s,typeof o),j(null)),o instanceof Error&&!(o.message in ce)&&(ce[o.message]=!0,j(l),m(\"Failed %s type: %s\",t,o.message),j(null))}}}var Be=Array.isArray;function W(e){return Be(e)}function ze(e){{var n=typeof Symbol==\"function\"&&Symbol.toStringTag,t=n&&e[Symbol.toStringTag]||e.constructor.name||\"Object\";return t}}function Ge(e){try{return de(e),!1}catch{return!0}}function de(e){return\"\"+e}function fe(e){if(Ge(e))return m(\"The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.\",ze(e)),de(e)}var E=N.ReactCurrentOwner,Xe={key:!0,ref:!0,__self:!0,__source:!0},me,be,$;$={};function Ke(e){if(P.call(e,\"ref\")){var n=Object.getOwnPropertyDescriptor(e,\"ref\").get;if(n&&n.isReactWarning)return!1}return e.ref!==void 0}function He(e){if(P.call(e,\"key\")){var n=Object.getOwnPropertyDescriptor(e,\"key\").get;if(n&&n.isReactWarning)return!1}return e.key!==void 0}function Je(e,n){if(typeof e.ref==\"string\"&&E.current&&n&&E.current.stateNode!==n){var t=g(E.current.type);$[t]||(m('Component \"%s\" contains the string ref \"%s\". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',g(E.current.type),e.ref),$[t]=!0)}}function Qe(e,n){{var t=function(){me||(me=!0,m(\"%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)\",n))};t.isReactWarning=!0,Object.defineProperty(e,\"key\",{get:t,configurable:!0})}}function Ze(e,n){{var t=function(){be||(be=!0,m(\"%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)\",n))};t.isReactWarning=!0,Object.defineProperty(e,\"ref\",{get:t,configurable:!0})}}var en=function(e,n,t,i,l,c,s){var o={$$typeof:r,type:e,key:n,ref:t,props:s,_owner:c};return o._store={},Object.defineProperty(o._store,\"validated\",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(o,\"_self\",{configurable:!1,enumerable:!1,writable:!1,value:i}),Object.defineProperty(o,\"_source\",{configurable:!1,enumerable:!1,writable:!1,value:l}),Object.freeze&&(Object.freeze(o.props),Object.freeze(o)),o};function nn(e,n,t,i,l){{var c,s={},o=null,b=null;t!==void 0&&(fe(t),o=\"\"+t),He(n)&&(fe(n.key),o=\"\"+n.key),Ke(n)&&(b=n.ref,Je(n,l));for(c in n)P.call(n,c)&&!Xe.hasOwnProperty(c)&&(s[c]=n[c]);if(e&&e.defaultProps){var d=e.defaultProps;for(c in d)s[c]===void 0&&(s[c]=d[c])}if(o||b){var f=typeof e==\"function\"?e.displayName||e.name||\"Unknown\":e;o&&Qe(s,f),b&&Ze(s,f)}return en(e,o,b,l,i,E.current,s)}}var U=N.ReactCurrentOwner,he=N.ReactDebugCurrentFrame;function C(e){if(e){var n=e._owner,t=V(e.type,e._source,n?n.type:null);he.setExtraStackFrame(t)}else he.setExtraStackFrame(null)}var q;q=!1;function B(e){return typeof e==\"object\"&&e!==null&&e.$$typeof===r}function pe(){{if(U.current){var e=g(U.current.type);if(e)return`\n\nCheck the render method of \\``+e+\"`.\"}return\"\"}}function tn(e){{if(e!==void 0){var n=e.fileName.replace(/^.*[\\\\\\/]/,\"\"),t=e.lineNumber;return`\n\nCheck your code at `+n+\":\"+t+\".\"}return\"\"}}var ge={};function rn(e){{var n=pe();if(!n){var t=typeof e==\"string\"?e:e.displayName||e.name;t&&(n=`\n\nCheck the top-level render call using <`+t+\">.\")}return n}}function _e(e,n){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var t=rn(n);if(ge[t])return;ge[t]=!0;var i=\"\";e&&e._owner&&e._owner!==U.current&&(i=\" It was passed a child from \"+g(e._owner.type)+\".\"),C(e),m('Each child in a list should have a unique \"key\" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',t,i),C(null)}}function ve(e,n){{if(typeof e!=\"object\")return;if(W(e))for(var t=0;t<e.length;t++){var i=e[t];B(i)&&_e(i,n)}else if(B(e))e._store&&(e._store.validated=!0);else if(e){var l=ke(e);if(typeof l==\"function\"&&l!==e.entries)for(var c=l.call(e),s;!(s=c.next()).done;)B(s.value)&&_e(s.value,n)}}}function an(e){{var n=e.type;if(n==null||typeof n==\"string\")return;var t;if(typeof n==\"function\")t=n.propTypes;else if(typeof n==\"object\"&&(n.$$typeof===O||n.$$typeof===R))t=n.propTypes;else return;if(t){var i=g(n);qe(t,e.props,\"prop\",i,e)}else if(n.PropTypes!==void 0&&!q){q=!0;var l=g(n);m(\"Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?\",l||\"Unknown\")}typeof n.getDefaultProps==\"function\"&&!n.getDefaultProps.isReactClassApproved&&m(\"getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.\")}}function on(e){{for(var n=Object.keys(e.props),t=0;t<n.length;t++){var i=n[t];if(i!==\"children\"&&i!==\"key\"){C(e),m(\"Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.\",i),C(null);break}}e.ref!==null&&(C(e),m(\"Invalid attribute `ref` supplied to `React.Fragment`.\"),C(null))}}function sn(e,n,t,i,l,c){{var s=Ae(e);if(!s){var o=\"\";(e===void 0||typeof e==\"object\"&&e!==null&&Object.keys(e).length===0)&&(o+=\" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.\");var b=tn(l);b?o+=b:o+=pe();var d;e===null?d=\"null\":W(e)?d=\"array\":e!==void 0&&e.$$typeof===r?(d=\"<\"+(g(e.type)||\"Unknown\")+\" />\",o=\" Did you accidentally export a JSX literal instead of a component?\"):d=typeof e,m(\"React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s\",d,o)}var f=nn(e,n,t,l,c);if(f==null)return f;if(s){var h=n.children;if(h!==void 0)if(i)if(W(h)){for(var T=0;T<h.length;T++)ve(h[T],e);Object.freeze&&Object.freeze(h)}else m(\"React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.\");else ve(h,e)}return e===y?on(f):an(f),f}}var ln=sn;G.Fragment=y,G.jsxDEV=ln})()});var Ee=z((Tn,we)=>{\"use strict\";we.exports=Te()});var yn={};bn(yn,{default:()=>vn,frontmatter:()=>gn});var a=hn(Ee()),gn={title:\"CoreOS: thousands of machines and millions of Docker containers... no hypervisor needed.\",excerpt:'I have been playing around with CoreOS to get a sense of how everything works. The vision of this project is incredible. CoreOS describes itself as \"a new Linux distribution that has been re-architected to provide features needed to run modern infrastructure stacks. The strategies and architectures that influence CoreOS allow companies like Google, Facebook and Twitter to run their services at scale with high resilience.\"',coverImage:\"/assets/blog/img/coreos_2.png\",date:\"2014-06-29\",published:!0,author:{name:\"Dan Stroot\",picture:\"/assets/blog/authors/dan.jpeg\"},ogImage:{url:\"/assets/blog/img/coreos_2.png\"},seoURL:\"https://danstroot.com/2014/06/28/coreos-thousands-of-machines-and-millions-of-docker-containers-no-hypervisor-needed/\"};function Oe(u){let r=Object.assign({p:\"p\",em:\"em\",h4:\"h4\",ul:\"ul\",li:\"li\",strong:\"strong\",a:\"a\",h3:\"h3\",img:\"img\"},u.components);return(0,a.jsxDEV)(a.Fragment,{children:[(0,a.jsxDEV)(r.p,{children:\"I have been playing around with CoreOS to get a sense of how everything works. The vision of this project is incredible.\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:21,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.p,{children:[\"CoreOS describes itself as \",(0,a.jsxDEV)(r.em,{children:'\"a new Linux distribution that has been re-architected to provide features needed to run modern infrastructure stacks. The strategies and architectures that influence CoreOS allow companies like Google, Facebook and Twitter to run their services at scale with high resilience.\"'},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:23,columnNumber:28},this)]},void 0,!0,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:23,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.p,{children:\"CoreOS displaces hypervisors and machine virtualization in favor of Docker and Linux containers. CoreOS uses Linux containers to manage your services at a high level of abstraction. A single service's code and all dependencies are packaged within a container that can be run on one or many CoreOS machines.\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:25,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.p,{children:\"Clustering works across platforms, meaning there is no cloud vendor lock-in. For example, CoreOS runs on Amazon EC2, Rackspace, QEMU/KVM, VMware and OpenStack and your own hardware. Running a single CoreOS cluster on multiple different clouds or cloud + bare metal is supported and encouraged. This lack of lock-in is the reason why I have supported OpenStack and CoreOS takes this even further.\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:27,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.h4,{id:\"we-begin-with-concept-of-a-large-fleet-of-machines-that-start-and-remain-exactly-consistent-at-the-os-level\",children:\"We begin with concept of a large fleet of machines that start (and remain) exactly consistent at the OS level\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:29,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.ul,{children:[`\n`,(0,a.jsxDEV)(r.li,{children:'First, think of CoreOS somewhat like you might think of a hypervisor today. It is the first layer you put down on bare metal, or as a virtual machine in a cloud. It is a \"bare minimum\" Linux-based OS that supports Linux LXC containers.'},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:31,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.li,{children:\"It is designed to run as a large fleet (hive?) of machines. It includes built-in primitives such as distributed locking and master election, plus key services necessary to manage the fleet of machines. (more on this later).\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:32,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.li,{children:[\"It is meant to always be consistent across machines.\",`\n`,(0,a.jsxDEV)(r.ul,{children:[`\n`,(0,a.jsxDEV)(r.li,{children:[\"CoreOS utilizes an active/passive dual-partition scheme to update the OS as a \",(0,a.jsxDEV)(r.em,{children:\"single unit\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:34,columnNumber:83},this),\" instead of \",(0,a.jsxDEV)(r.em,{children:\"package by package\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:34,columnNumber:108},this),\".\"]},void 0,!0,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:34,columnNumber:3},this),`\n`,(0,a.jsxDEV)(r.li,{children:[\"CoreOS also has the tenant of \",(0,a.jsxDEV)(r.strong,{children:\"automatically\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:35,columnNumber:35},this),\" updating itself. This avoids the issue of inconsistent state from machine to machine within a large cluster. Conceptually this is roughly like a self-updating hypervisor.\"]},void 0,!0,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:35,columnNumber:3},this),`\n`,(0,a.jsxDEV)(r.li,{children:\"Each machine has to acquire and hold a reboot lock before it is allowed to reboot. The reboot lock is held until the machine releases it after a successful update. The number of machines allowed to reboot simultaneously is configurable. The main goal to allow for an update to be applied to a fleet quickly, without impacting capacity for the services running on the cluster.\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:36,columnNumber:3},this),`\n`]},void 0,!0,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:34,columnNumber:3},this),`\n`]},void 0,!0,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:33,columnNumber:1},this),`\n`]},void 0,!0,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:31,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.h4,{id:\"next-we-have-the-concept-that-the-fleet-of-machines-is-simply-a-single-pool-of-compute-resources\",children:\"Next, we have the concept that the fleet of machines is simply a single pool of compute resources\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:38,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.ul,{children:[`\n`,(0,a.jsxDEV)(r.li,{children:\"You treat your CoreOS cluster as if it has a single, shared init system - one giant systemd if you will.\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:40,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.li,{children:\"Instead of running a service on a specific machine, services are submitted to the cluster via the cluster manager, fleetctl, which decides where they should run.\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:41,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.li,{children:\"Your services/applications are in containers that act as small, ephemeral units that can easily migrate around a cluster of self-updating CoreOS machines.\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:42,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.li,{children:\"It is smart enough to distribute services across a cluster using machine-level affinity or anti-affinity.\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:43,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.li,{children:\"If your application consists of 5 containers fleet will guarantee that they stay running somewhere on the cluster. If a machine fails or needs to be updated, containers running on that machine will be moved to other qualified machines in the cluster.\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:44,columnNumber:1},this),`\n`]},void 0,!0,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:40,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.h4,{id:\"-with-a-single-shared-brain\",children:\"... with a single, shared brain\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:46,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.ul,{children:[`\n`,(0,a.jsxDEV)(r.li,{children:'CoreOS provides a distributed key value store called \"etcd\".'},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:48,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.li,{children:\"The etcd client runs on each machine in a cluster. etcd gracefully handles master election during network partitions and the loss of the current master.\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:49,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.li,{children:\"Docker containers can read, write and listen to etcd over the docker0 network interface. With these three actions you construct extremely sophisticated orchestration to happen whenever etcd values change. An example of this would be listening for changes and then to reconfigure an upstream proxy when a new container of an application is started.\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:50,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.li,{children:\"Since etcd is replicated, all changes are reflected across the entire cluster. Your application can always reach the local etcd instance at 127.0.0.1:4001.\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:51,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.li,{children:[\"Your applications can read and write data into etcd. Common examples are storing database connection details, cache settings, feature flags, and more. Let's say we're running a simple web app like Wordpress. Instead of hardcoding our database address with in the config file, we'll fetch it from etcd instead. It's as simple as curl-ing \",(0,a.jsxDEV)(r.a,{href:\"http://127.0.0.1:4001/v1/keys/database\",children:\"http://127.0.0.1:4001/v1/keys/database\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:52,columnNumber:340},this),\" and using the response within your DB connection code.\"]},void 0,!0,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:52,columnNumber:1},this),`\n`]},void 0,!0,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:48,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.h3,{id:\"summary\",children:\"Summary\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:54,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.p,{children:\"So now we have a hive of self-updating Linux hosts with a single, distributed init system (systemd and fleet) and a single shared brain (etcd). It looks something like this:\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:56,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.p,{children:(0,a.jsxDEV)(r.img,{src:\"https://danstroot.imgix.net/assets/blog/img/coreos-action.png\",alt:\"CoreOS in Action\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:58,columnNumber:1},this)},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:58,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.p,{children:'This depicts eight containers (two load balancers and six api servers) being managed by \"fleet\" to run in various CoreOS hosts in the cluster, with shared access to etcd.'},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:60,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.p,{children:[\"Momentum is shifting this way rapidly. Earlier this month Rackspace announced \",(0,a.jsxDEV)(r.a,{href:\"https://www.rackspace.com/blog/onmetal-the-right-way-to-scale/\",children:\"OnMetal\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:62,columnNumber:79},this),\". Rackspace's OnMetal Cloud Service is the first of its kind. Using OnMetal you create machine instances using OpenStack APIs but, instead of being provisioned a virtual machine, you are provisioned \",(0,a.jsxDEV)(r.strong,{children:\"on physical hardware\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:62,columnNumber:351},this),\". OnMetal servers are single-tenant, bare-metal servers provisioned via the OpenStack API and can be spun up as quickly as VMs.\"]},void 0,!0,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:62,columnNumber:1},this),`\n`,(0,a.jsxDEV)(r.p,{children:\"Once OnMetal is live, you'll be able to provision CoreOS instances on Rackspace's OnMetalcloud. This combination gives you the ease of spinning up machines with the click of a mouse, the security of running CoreOS with automatic updates, and the raw horsepower of running on bare metal. Pretty impressive!\"},void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:64,columnNumber:1},this)]},void 0,!0,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\",lineNumber:1,columnNumber:1},this)}function _n(u={}){let{wrapper:r}=u.components||{};return r?(0,a.jsxDEV)(r,Object.assign({},u,{children:(0,a.jsxDEV)(Oe,u,void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\"},this)}),void 0,!1,{fileName:\"/Volumes/T7/Code/blog-next-13/content/posts/_mdx_bundler_entry_point-1fb26f11-ccfe-4600-a487-8e9a9db0d2c4.mdx\"},this):Oe(u)}var vn=_n;return pn(yn);})();\n/*! Bundled license information:\n\nreact/cjs/react-jsx-dev-runtime.development.js:\n  (**\n   * @license React\n   * react-jsx-dev-runtime.development.js\n   *\n   * Copyright (c) Facebook, Inc. and its affiliates.\n   *\n   * This source code is licensed under the MIT license found in the\n   * LICENSE file in the root directory of this source tree.\n   *)\n*/\n;return Component;"
  },
  "_id": "posts/2014-06-29-coreos-thousands-of-machines-and-millions-of-docker-containers-no-hypervisor-needed.mdx",
  "_raw": {
    "sourceFilePath": "posts/2014-06-29-coreos-thousands-of-machines-and-millions-of-docker-containers-no-hypervisor-needed.mdx",
    "sourceFileName": "2014-06-29-coreos-thousands-of-machines-and-millions-of-docker-containers-no-hypervisor-needed.mdx",
    "sourceFileDir": "posts",
    "contentType": "mdx",
    "flattenedPath": "posts/2014-06-29-coreos-thousands-of-machines-and-millions-of-docker-containers-no-hypervisor-needed"
  },
  "type": "Post",
  "slug": "/posts/2014-06-29-coreos-thousands-of-machines-and-millions-of-docker-containers-no-hypervisor-needed",
  "slugAsParams": "2014-06-29-coreos-thousands-of-machines-and-millions-of-docker-containers-no-hypervisor-needed",
  "stats": {
    "text": "5 min read",
    "minutes": 4.63,
    "time": 277800,
    "words": 926
  }
}